"use strict";(self.webpackChunkspire=self.webpackChunkspire||[]).push([[897],{5897:(Z,S,a)=>{a.r(S),a.d(S,{StudentRegisterCourseComponent:()=>x});var c=a(4755),D=a(4933),g=a(1728),_=a(6012),m=a(9114),f=a(8097),h=a(1388),l=a(8381),p=a(787),i=a(9401),e=a(2223),d=a(4242),I=a(823),v=a(1217);function E(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"div",5)(1,"mat-form-field",13)(2,"mat-label"),e._uU(3,"Student Id"),e.qZA(),e._UZ(4,"input",14,15),e.qZA(),e.TgZ(6,"button",16),e.NdJ("click",function(){e.CHM(t);const r=e.MAs(5),o=e.oxw(2);return e.KtG(o.GetStudentData(r.value))}),e._uU(7,"Get student"),e.qZA()()}}function P(n,u){if(1&n&&(e.TgZ(0,"mat-option",17),e._uU(1),e.qZA()),2&n){const t=u.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.course.course_Name," ")}}function T(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.AddCourseToStudent())}),e._uU(1,"Add "),e.qZA()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",t.form.invalid||0==t.SemesterCourseProfessor.length)}}function A(n,u){if(1&n&&(e.TgZ(0,"mat-card-footer",19)(1,"p"),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.hij("Last enroll date: ",e.lcZ(3,2,t.currentSemester.lastCourseEnrollmentDate),""),e.xp6(3),e.hij("Last drop date: ",e.lcZ(6,4,t.currentSemester.lastCourseWithdrawalDate),"")}}function b(n,u){if(1&n&&(e.TgZ(0,"div",20)(1,"span",21),e._uU(2),e.qZA(),e.TgZ(3,"span",21),e._uU(4),e.ALo(5,"date"),e.qZA(),e.TgZ(6,"span",21),e._uU(7),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(2),e.AsE("Student Name: ",t.student.applicationUser.fName," ",t.student.applicationUser.lName,""),e.xp6(2),e.hij("Registeration Date: ",e.lcZ(5,4,t.student.registerDate)," "),e.xp6(3),e.hij("Total Credit hours: ",t.student.total_Credit_Hours," ")}}function O(n,u){if(1&n){const t=e.EpF();e.TgZ(0,"form",2)(1,"mat-card",3)(2,"mat-card-content"),e.YNc(3,E,8,0,"div",4),e.TgZ(4,"div",5)(5,"mat-form-field",6)(6,"mat-label"),e._uU(7,"Courses"),e.qZA(),e.TgZ(8,"mat-select",7,8),e.NdJ("valueChange",function(){e.CHM(t);const r=e.MAs(9),o=e.oxw();return e.KtG(o.GetCourseRestrictions(r.value))}),e.YNc(10,P,2,2,"mat-option",9),e.qZA()(),e.YNc(11,T,2,1,"button",10),e.qZA()(),e.YNc(12,A,7,6,"mat-card-footer",11),e.qZA()(),e.TgZ(13,"mat-card",3)(14,"mat-card-content"),e.YNc(15,b,8,6,"div",12),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("formGroup",t.form),e.xp6(3),e.Q6J("ngIf",null==t.StudentInLocalStorage),e.xp6(5),e.Q6J("disabled",0==t.SemesterCourseProfessor.length),e.xp6(2),e.Q6J("ngForOf",t.SemesterCourseProfessor),e.xp6(1),e.Q6J("ngIf",t.disableEntroll),e.xp6(1),e.Q6J("ngIf",t.currentSemester),e.xp6(3),e.Q6J("ngIf",t.student)}}const R=function(){return["Home"]};let x=(()=>{class n{constructor(t,s,r,o,C,M,U){this.studentService=t,this.SemesterService=s,this.ProfessorService=r,this.SwalService=o,this.fb=C,this.restrectionTypes=M,this.Sem_Course_Prof_StudentService=U,this.dataSource=[],this.displayedColumnsForGeneric=[{propertyName:"course_Name",ColumnName:"Course Name"}],this.currentDate=Date.now(),this.disableEntroll=!1,this.disableWithdraw=!1,this.student=null,this.StudentInLocalStorage=null,this.studentId=0,this.SemesterCourseProfessor=[],this.CoursesRestrications=[],this.currentSemester=null,this.userRole="",this.form=this.fb.group({id:[0],smesterCourseProfessorId:[0,i.kI.required],studenteId:[0,i.kI.required]})}ngOnInit(){let t=localStorage.getItem("user"),s=t?JSON.parse(t):new h.y6;this.userRole=s.roles;var r="null"==localStorage.getItem("student")?null:localStorage.getItem("student");null!=r&&(this.StudentInLocalStorage=r?JSON.parse(r):new h.Z1,this.studentId=this.StudentInLocalStorage.id,this.form.patchValue({studenteId:this.studentId}),this.GetStudentData(this.studentId)),this.SemesterService.getAll(l.KG.GetCurrentSemester).subscribe(o=>{this.currentSemester=o,this.disableEntroll=this.DiableEnrolOrWithDraw(this.currentSemester.lastCourseEnrollmentDate),this.disableWithdraw=this.DiableEnrolOrWithDraw(this.currentSemester.lastCourseWithdrawalDate)})}GetCourseRestrictions(t){let s=this.SemesterCourseProfessor.find(r=>r.id==t);this.restrectionTypes.GetById(l._W.GetCourseRestrictionsByCourseId,s?.courseId).subscribe(r=>{this.CoursesRestrications=r})}GetStudentData(t){this.studentId=t,this.studentService.GetById(l.qO.getById,t).subscribe({next:s=>{this.student=s,localStorage.setItem("student",JSON.stringify(s)),this.ProfessorService.GetById(l.NY.GetSemesterCourseProgramInCurrentSemester,s.academicProgramId).subscribe(r=>{this.SemesterCourseProfessor=r}),this.getStudentRegisteredCourse(s.id)},error:s=>{this.SwalService.Fail()}})}AddCourseToStudent(){if(this.dataSource.find(o=>o.course_Name==this.SemesterCourseProfessor.find(C=>C.id==this.form.value.smesterCourseProfessorId)?.course.course_Name))return void this.SwalService.Fail("Course already registered");let t=this.dataSource.map(o=>o.course_Name.toLowerCase().replace(/\s/g,"")),s=this.CoursesRestrications.map(o=>o.restricationValue),r=!1;s.forEach(o=>{t.includes(o.toLowerCase().replace(/\s/g,"")||0==t.length)||(this.SwalService.Fail(`The student must complete ${o} before registering this course`),r=!0)}),!r&&this.Sem_Course_Prof_StudentService.add(l.qO.AddSem_Course_Prof_Student,this.form.value).subscribe({next:o=>{this.GetStudentData(o.studenteId),this.SwalService.Success()},error:o=>{this.SwalService.Fail(o.error.message)}})}getStudentRegisteredCourse(t){this.Sem_Course_Prof_StudentService.GetById(l.qO.GetSem_Course_Prof_StudentByStudentId,t).subscribe(s=>{console.log(s);let r=[];s.forEach(o=>{r.push({id:o.id,studentId:o.student.id,course_Name:o.semesterCourseProfessor.course.course_Name})}),this.dataSource=r})}DeleteSem_Course_Prof_Student(t){t.swalResponse&&this.Sem_Course_Prof_StudentService.Delete(l.qO.DeleteSem_Course_Prof_Student,t.element.id).subscribe({next:s=>{this.GetStudentData(t.element.studentId),this.SwalService.Success()},error:s=>{this.SwalService.Fail(s.error.message)}})}DiableEnrolOrWithDraw(t){return new Date(t)>new Date&&this.userRole.toLowerCase().includes("student")||this.userRole.toLowerCase().includes("admin")}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.v),e.Y36(d.v),e.Y36(d.v),e.Y36(I.J),e.Y36(i.qu),e.Y36(d.v),e.Y36(d.v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-student-register-course"]],standalone:!0,features:[e.jDz],decls:3,vars:9,consts:[["BreadCrumbTitle","Student course register",3,"dataSource","ColumnDefs","BreadCrumbActive_item","BreadCrumbItems","UseEditButton","UseAddNewButton","UseDeleteButton","outsideTemplate","OnDeleteClick"],["FormDesignAboveTable",""],[3,"formGroup"],[1,"mb-2"],["class","col-12 mt-2 row ",4,"ngIf"],[1,"col-12","mt-2","row"],["appearance","outline",1,"col-8","mb-2"],["formControlName","smesterCourseProfessorId",3,"disabled","valueChange"],["CourseId",""],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","class","col-3 mx-2",3,"disabled","click",4,"ngIf"],["class","text-danger px-3 fs-4",4,"ngIf"],["class","row",4,"ngIf"],["appearance","outline",1,"col-8"],["matInput","","type","number","formControlName","studenteId"],["studentId",""],["mat-raised-button","","color","primary",1,"col-3","mx-2",3,"click"],[3,"value"],["mat-raised-button","","color","primary",1,"col-3","mx-2",3,"disabled","click"],[1,"text-danger","px-3","fs-4"],[1,"row"],[1,"col-md-6"]],template:function(t,s){if(1&t&&(e.TgZ(0,"my-table",0),e.NdJ("OnDeleteClick",function(o){return s.DeleteSem_Course_Prof_Student(o)}),e.YNc(1,O,16,7,"ng-template",null,1,e.W1O),e.qZA()),2&t){const r=e.MAs(2);e.Q6J("dataSource",s.dataSource)("ColumnDefs",s.displayedColumnsForGeneric)("BreadCrumbActive_item","Student course register")("BreadCrumbItems",e.DdM(8,R))("UseEditButton",!1)("UseAddNewButton",!1)("UseDeleteButton",s.disableWithdraw)("outsideTemplate",r)}},dependencies:[D.bC,c.uU,c.O5,p.LD,m.KE,m.hX,p.gD,v.ey,c.ax,g.ot,g.lW,m.lN,f.c,f.Nt,i.UX,i._Y,i.Fj,i.wV,i.JJ,i.JL,i.sg,i.u,_.QW,_.a8,_.dn,_.rt],encapsulation:2}),n})()}}]);